<!DOCTYPE html>
<html lang="nb-NO" xmlns="http://www.w3.org/1999/xhtml">

<head>

    <meta http-equiv="content-type" charset="utf-8" />
    <title>Programmering av filer pa SD kortet &ndash; air:bit Wiki</title>

    <!-- Boots -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk="
        crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'></script>
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <!-- d3 -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-93186535-1', 'auto');
        ga('send', 'pageview');</script>
    <link rel="stylesheet" href="/public/css/style.css" />
    <script src="/public/js/vis.js"></script>

</head>

<body>
    <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
        <button class="navbar-toggler navbar-toggler-right custom-toggler" type="button" data-toggle="collapse" data-target="#navbar"
            aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="/">air:bit</a>
        <div class="collapse navbar-collapse" id="navbar">
            <ul class="navbar-nav mr-auto"></ul>
            <ul class="navbar-nav my-2 my-lg-0">
                <li class="nav-item">
                    <!-- <a class="nav-link" target="_blank" href="https://luft-184208.appspot.com/">Last opp data<span class="sr-only">(current)</span></a> -->
                    <a class="nav-link" href="/lastopp">Last opp data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/historikk">Søk i tid</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="live">Live</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="main">
        <div class="container container-fluid">

            <div class="row">
                <div class="col-xs-12 col-sm-9 col-sm-pull-3">
                    <div class="markdown">
                        <h1>Programmering av filer pa SD kortet</h1>
                        <hr> <p>Når du er ute og tar målinger med air:bit vil du ikke hele tiden ha den<br/>tilkoblet til din datamaskin. air:bit har ikke noe som forbinder seg med<br/>internettet. Så du vil trenge en måte å lagre måledata på. air:bit har en<br/>kortleser for microSD-kort. Et microSD-kort er i prinsippet bare en minnebrikke,<br/>veldig lik en vanlig USB-minnepen og faktisk nøyaktig lik minnekortet som finnes<br/>for å lagre data på nyere mobiltelefoner, minnekortet til digitalkamere, osv.</p>
<p>microSD-kortet som følger med air:bit har ganske stor lagringskapasitet. Du vil<br/>kunne lagre flere år med målingsdata på dette, så i prinsippet skal du ikke<br/>bekymre deg for at du ikke har nok plass på &quot;harddisken&quot; til air:bit.</p>
<p>Du vil legge merke til at microSD-kortet kommer med adapter. Det bitte lille<br/>microSD-kortet passer inn i den større adapteren og former slikt et vanlig<br/>SD-kort. Laptopter nå til dags har som regel porter hvor du kan plugge inn<br/>SD-kort. Ellers finnes det også veldig vanlige kortterminaler man kan kjøpe som<br/>har SD-kort plugger og som kobles i en vanlig USB-port på PC-en din.</p>
<p>Når du plugger inn SD-kortet inn i en PC, vil det dukke opp som en harddisk i<br/>Filutforskeren (<code>Windows Explorer</code>, eller <code>Min datamaskin</code>, eller <code>This PC</code>)<br/>akkurat som en vanlig USB-minnebrikke også ville gjort.</p>
<h2 id="beskrivelse-av-eksemplet">Beskrivelse av eksemplet</h2>
<p>I dette eksemplet kommer du til å først lage en ny fil på SD-kortet. Så kommer<br/>du til å skrive ned tekst in den filen. For hver gjennomgang gjennom <code>loop</code><br/>skal vi øke en teller og skrive ned verdien av telleren.</p>
<p>Dette vil derfor likne veldig på<br/><a href="Variabler-og-telling-i-Arduino.html">kodeeksemplet om variabler og telling i Arduino</a>. Du vil i<br/>prinsippet gjøre nøyaktig det samme i dette eksemplet, borsett fra at du skriver<br/>til en fil på SD-kortet, i stedet for seriell-tilkoblingen til datamaskinen.</p>
<h2 id="ny-sketch">Ny Sketch</h2>
<p>Start med en helt ny Sketch. Menypunkt: <code>File</code>&rarr;<code>New</code>.</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span> <span class="hljs-params">()</span> </span>{

}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{

}
</code></pre>
<h2 id="laste-ned-og-installere-bibliotek">Laste ned og installere bibliotek</h2>
<p><code>SD</code>-biblioteket er allerede forhåndsinstallert sammen med <code>Arduino IDE</code>. Det<br/>vil ikke være nødvendig å laste ned noe for dette eksemplet.</p>
<h2 id="globale-definisjoner">Globale definisjoner</h2>
<p>Først må inkludere <code>SD</code>-biblioteket. Bruk navnet <code>&lt;SD.h&gt;</code> for <code>#include</code><br/>direktivet.</p>
<p>Fra <a href="airbit-Pinout.html">pinout skjemaet</a> ser du at det er flere pinner som kobler<br/>SD-kortleseren til Arduinoen. Vi trenger en definisjon for <code>CS</code> pinnen i koden<br/>vår.</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SD_CS_PIN 10</span>
</code></pre>
<p>Så vil du lage en global variabel får å representere skrivingen til filen på<br/>SD-kortet. Vi bruker datatypen <code>File</code> for dette. Merk at å lage en variabel vil<br/><strong>ikke</strong> automatisk lage en fil SD-kortet. Variablen her er på en måte bare den<br/>ene enden av en telefonledning som går fra din Arduino til SD-kortet. Du vil<br/>skrive kode for å lage og åpne filen, og så skrive til den (liknende til at<br/>du må først slå ett nummer for å få en telefonsamtale, og du må faktisk begynne<br/>å prate for å sende &quot;data&quot;, dvs. din tale, over ledningen).</p>
<pre><code class="lang-cpp">File file;
</code></pre>
<p><em>I koden over navngis tilkoblingen til filen <code>file</code>. Du kan bruke hvilket som<br/>helst navn for variablen du vil. Dette vil ikke være navnen på filen du lagrer<br/>på SD-kortet!</em></p>
<p>Til slutt må vi lage en global teller variabel. Dette vil være et heltall, så<br/>bruk datatypen <code>int</code>.</p>
<h2 id="-setup-"><code>setup</code></h2>
<p>Frøst må du aktivere kontroll over <code>CS</code>-pinnen. Dette funker akkurat som du gjør<br/>får å aktivere pinnene til LED-lysene. Bruk <code>pinMode</code> med pinnen som første og<br/><code>OUTPUT</code> som andre argument.</p>
<pre><code class="lang-cpp">  pinMode(SD_CS_PIN, OUTPUT);
</code></pre>
<p>Vanligvis ville du initialisere seriell-kommunikasjonen til datamaskinen nå ved<br/>å bruke <code>Serial.begin</code> kommandoen. Men la oss heller starte opp SD-kortet. Bruk<br/><code>SD.begin</code> kommandoen, og spesifiser <code>CS</code>-pinnen kortleseren er koblet til.</p>
<pre><code class="lang-cpp">  SD.begin(SD_CS_PIN);
</code></pre>
<p>Nå må du bestemme deg for et navn for filen. Filnavnet er det du vil se i<br/>Filutforskeren (<code>Min datamaskin</code>) når du viser innholdet på SD-kortet etter du<br/>har plugget det inn i datamaskinen. Et filnavn er flere bokstaver<br/>etterhverandre. I <code>C++</code> bruker vi datatypen <code>char</code> for én bokstav. Vi bruker<br/>firkantparanteser <code>[</code> og <code>]</code> for å lage en variabel som lagrer <em>flere</em> verdier<br/>av samme type etterhverandre. Akkurat det vi trenger, det ser slikt ut:</p>
<pre><code class="lang-cpp">  <span class="hljs-keyword">char</span> filename[] = <span class="hljs-string">"testfile.txt"</span>;
</code></pre>
<p>I koden over ser du deklarasjonen av variablen <code>filename</code>. Firkantparantesene<br/>skrives rett <strong>etter</strong> navnet. Verdien er bokstavene <code>testfile.txt</code>, og som<br/>vanlig står tekst mellom to anførelsestegn <code>&quot;</code>.</p>
<p>I koden over er filnavnet <code>testfile.txt</code> valgt, men du kan bruke hvilket navn du<br/>vil. Å la filnavnet slutte med <code>.txt</code> er veldig vanlig, og vil automatisk<br/>fortelle til datamaskinen din at du mener å lagre vanlig tekst i filen. Du har<br/>kanskje sett at Word lagrer Word-dokumenter i <code>.doc</code> (eller nyere <code>.docx</code>)<br/>filer. Arduino-bibliotekene du lastet ned i tidligere guider bruker <code>.zip</code>, osv.<br/>Nå skal vi skrive ned tekst, så <code>.txt</code> virker mest hensiktsmessig.</p>
<p>Nå må du faktisk lage en ny fil på SD-kortet. Dette gjøres med kommandoen<br/><code>SD.open</code>. Kommandoen tar først imot filnavnet, og så en <em>modus</em>. Filer kan<br/>åpnes bare for lesing, eller for skriving, eller begge deler. Når du åpner ett<br/>dokument i Word, vil det vanligvis åpnes for skriving, slik at du kan redigere<br/>dokumentet. En videospiller deriot vil bare lese en fil, du vil ikke endre på en<br/>video når du bare skal spille den av. Koden ser slik ut:</p>
<pre><code class="lang-cpp">  file = SD.open(filename, O_CREAT | O_WRITE);
</code></pre>
<p><code>SD.open</code> kommandoen vil gi oss tilkoblingen til filen som resultat, derfor<br/>lagrer vi denne i vår globale variabel for filtilkoblingen (kalt <code>file</code>).<br/><code>O_CREAT | O_WRITE</code> betyr: Lag ny fil (<code>O_CREAT</code>) og åpne filen for skriving<br/>(<code>O_WRITE</code>). <em>Du finner <code>|</code> (pipe-symbolet) til venstre for <code>1</code>-tasten i den<br/>øverste raden på et vanlig norsk tastatur.</em></p>
<p>Når filen er åpnet, la oss skrive en velkomsttekst til den første linja i filen:</p>
<pre><code class="lang-cpp">  file.println(<span class="hljs-string">"Dette er den første linjen i filen."</span>);
</code></pre>
<p>Merk at vi bruker <code>file.println</code> der vi ville brukt <code>Serial.println</code> før. <code>file</code><br/>viser her til navnet på fil-variablen du bruker. Den kan være forskjellig dersom<br/>du har navngitt variablen anderledes.</p>
<p>Se for deg at du skriver masse tekst i ett Word-dokument. Du vil kanskje ha lagt<br/>merke til at dokumentet ikke lagres til harddisken din med én gang du skriver<br/>noe. Du må trykke på <code>Lagre</code>-knappen for å lagre dokumentet. Og du har kanskje<br/>også lagt merke til at ting bilr borte dersom du glemmer å lagre.</p>
<p>Det samme gjelder for tilkoblingen vår til filen. Det holder ikke å bare bruke<br/><code>print</code>, eller <code>println</code> kommandoene for å skrive noe til filen. Hver gang du<br/>er ferdig med å skrive ned en viktig del informasjon bør du bruke <code>flush</code>-<br/>kommandoen for å sikre at alt blir lagret på SD-kortet. Siden vi nå er kommet<br/>til slutten av <code>setup</code>-blokken er det en god idé og gjøre dette nå, før vi<br/>fortsetter med <code>loop</code>.</p>
<pre><code class="lang-cpp">  file.flush();
</code></pre>
<p>Helt til slutt må du også huske å initialisere teller-variablen til <code>0</code>.</p>
<p>Sålangt burde koden din se omrent slik ut:</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SD.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SD_CS_PIN 10</span>

File file;
<span class="hljs-keyword">int</span> counter;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// Activate CS-Pin control</span>
  pinMode(SD_CS_PIN, OUTPUT);

  <span class="hljs-comment">// Startup SD-card reader</span>
  SD.begin(SD_CS_PIN);

  <span class="hljs-comment">// Define filename</span>
  <span class="hljs-keyword">char</span> filename[] = <span class="hljs-string">"testfile.txt"</span>;

  <span class="hljs-comment">// Create new file and open for writing</span>
  file = SD.open(filename, O_CREAT | O_WRITE);

  file.println(<span class="hljs-string">"Dette er den første linjen i filen."</span>);
  file.flush(); <span class="hljs-comment">// Force saving data to SD-card</span>

  <span class="hljs-comment">// Start counter at 0</span>
  counter = <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{

}
</code></pre>
<h2 id="-loop-"><code>loop</code></h2>
<p>For hver gjennomgang gjennom <code>loop</code> vil vi skrive en ny linje med tekst. Teksten<br/>vi skriver skal også inneholde verdien til telleren vår. Vi må også øke telleren<br/>for hver gang.</p>
<p>Vi kan starte med å øke telleren med én. Bruk <code>+=</code> instruksjonen til dette.</p>
<p>Så skriver vi ned litt tekst, som f.eks <code>Dette er linje nr.:</code>. Så skriver vi en<br/>tekst med bare et mellomrom, for å skille <code>:</code> fra verien til telleren. Og så<br/>kan vi skrive selve teller-verdien. Bruk <code>file.print</code>-kommandoen flere ganger<br/>for å skrive ned alle delene av teksten og avslutt linjen ved å bruke<br/><code>file.println</code>-kommandoen.</p>
<p>Når vi er ferdige, burde vi forsikre oss at teksten blir lagret på SD-kortet.<br/>Bruk <code>file.flush</code>-kommandoen helt til slutt.</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  counter += <span class="hljs-number">1</span>;

  file.print(<span class="hljs-string">"Dette er linje nr.:"</span>);
  file.print(<span class="hljs-string">" "</span>);
  file.print(counter);
  file.println();

  file.flush();
}
</code></pre>
<p>Det kan også være en god idé å legge til en <code>delay</code>-kommando etter<br/><code>flush</code>-kommandoen på slutten, slik at du kun skrive en ny linje etter f.eks.<br/>ett sekund med venting.</p>
<h2 id="test-1">Test 1</h2>
<ol>
<li>Last opp koden du har skrevet så langt til air:bit.</li>
<li>Trekk så ut ledningen fra datamaskinen.</li>
<li>Sett inn microSD-kortet i kortleseren til air:bit gjennom sprekken<br/>på siden der det står <code>SD-kort</code>. Trykk inn kortet til det sier &quot;klikk&quot;.</li>
<li>Plugg USB-ledningen i batteriet til air:bit.</li>
<li>Vent en liten stund, f.eks. i 10 sekunder.</li>
<li>Trekk så ut ledningen fra batteriet igjen.</li>
<li>Trykk igjen på SD-kortet i air:bit, kortet burde sprette ut.</li>
<li>Skyv microSD-kortet i adapteren som følgte med i emballasjen til SD-kortet<br/>og plugg det hele i en SD-kortleser på din datamaskin.</li>
<li>PC-en din burde automatisk finne SD-kortet ditt når du plugger det inn. Du<br/>høre den vanlige lyden som spilles av når du plugger inn en USB-minnebrikke.</li>
<li>Om den ikke åpnes automatisk, velg <code>Min datamaskin</code> (<code>This PC</code>) i<br/>startmenyen.<br/>Du vil se SD-kortet som en egen ny harddisk. Dobbel-klikk for å vise filene<br/>på SD-kortet.</li>
<li>Du burde kun se én fil her. Filen burde ha det navnet du bruket i koden din,<br/>f.eks. <code>testfile.txt</code>. Det kan hende at du ikke ser filendelsen (<code>.txt</code>)<br/>siden Windows på noen datamaskiner skuler filendelser.<br/>Om du høyre-klikker på filen, og velger <code>Egenskaper</code> (<code>Properties</code>) vil du<br/>få opp et vindu med hele filnavnet (inklusive <code>.txt</code>).</li>
<li>Dobbel-klikk på filen for å åpne den og vise innholdet.<br/><img src="testfile-notepad.png" alt="Filinnholdet av testfile.txt i Notepad"/></li>
</ol>
<h2 id="ikke-overskriv-filen">Ikke overskriv filen</h2>
<p>Om du tester ut koden vi har skrevet så langt flere ganger, vil du legge merke<br/>til at air:bir skriver over filen hver gang du kobler den til strøm. Dvs. all<br/>data så lå i filen blir slettet hver gang du skrur på air:bit måleren. Dette<br/>virker ikke helt fornuftig. Det hadde kanskje vært bedre om vi bare la til ny<br/>data i en eksisterende fil dersom det allerede ligger noe der fra før.</p>
<p>Om du ser nøyere på <code>setup</code>-blokken, ser du problemet. Vi bruker <code>O_CREAT</code><br/>modusen for å lage en <strong>ny</strong> fil, der vi bruker <code>SD.open</code>-kommandoen. Og dette<br/>gjør vi hver gang air:bit kjører <code>setup</code>, dvs. hver gang du plugger i strømmen.<br/>Det vi trenger her er en betingelse som skjekker om filen allerede finnes. Vi<br/>vil ikke bruke <code>O_CREAT</code> når det allerede finnes en fil på SD-kortet som har<br/>samme navn som vi vil bruke.</p>
<p>Vi kan bruke <code>SD.exists</code>-kommandoen for å spørre om en fil med et gitt navn<br/>eksisterer på SD.kortet.</p>
<p>La oss altså lage en <code>if</code>-<code>else</code>-kombinasjon og flytte linja vi har nå inn i<br/><code>else</code>-blokken:</p>
<pre><code class="lang-cpp">  <span class="hljs-keyword">if</span> (SD.exists(filename)) {
    <span class="hljs-comment">// Do something new here if file already exists...</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// Create new file and open for writing</span>
    file = SD.open(filename, O_CREAT | O_WRITE);
    file.println(<span class="hljs-string">"Dette er den første linjen i filen."</span>);
  }
</code></pre>
<p>I koden over ser du at <code>if</code>-blokken forsatt er tom, så hva må gjøres dersom<br/>filen allerede eksisterer. Vi må fortsatt åpne filen og vi har allerede funnet<br/>ut at vi <strong>ikke</strong> vil bruke <code>O_CREAT</code>. Å bare bruke <code>O_WRITE</code> vil virkelig<br/>funke, men det er et lite problem med det også: Når en fil åpnes settes<br/>skrivemarkøren i filen på begynnelsen av filen. Dette er ikke noe problem i en<br/>ny fil, hvor ellers kunne markøren være, side det ikker er noe der fra før. Men<br/>å ha markøren i begynnelsen av en file som allerede inneholder data vil føre til<br/>at du overskriver data som er der. Det vi virkelig vil er å åpne filen, og<br/>plassere markøren helt i slutten, slik at vi bare legger til ny tekst uten å<br/>røre det som allerede står i filen. Heldigvis har vi <code>O_APPEND</code> modusen som gjør<br/>nettopp dette. <em>append</em> er engelsk for: legg til. Med dette ser hele <code>if</code>-<br/><code>else</code>-blokken slik ut:</p>
<pre><code class="lang-cpp">  <span class="hljs-keyword">if</span> (SD.exists(filename)) {
    <span class="hljs-comment">// Open existing file for writing and append</span>
    file = SD.open(filename, O_WRITE | O_APPEND);
    file.println(<span class="hljs-string">"--------------------"</span>);
    file.println(<span class="hljs-string">"Filen ble åpnet på nytt."</span>);
  } <span class="hljs-keyword">else</span> {
    file = SD.open(filename, O_CREAT | O_WRITE);
    file.println(<span class="hljs-string">"Dette er den første linjen i filen."</span>);
  }
</code></pre>
<p>Merk at koden over skriver en linje med 20 bindestreker i begynnelsen når en<br/>eksisterende fil åpnes. Dette vil gjøre det enkelt å finne skillet mellom to<br/>seksjoner i filen.</p>
<h2 id="test-2">Test 2</h2>
<p>Med de nye endringene vil du kunne slå av og på air:bit flere ganger. Filen på<br/>SD-kortet vil bare bli større og større etterhvert air:bit skriver mer og mer<br/>tekst til filen.</p>
<p>Du kan slette filen fra SD-kortet når du har kortet plugget inn i datamaskinen.<br/>Da vil ikke lengre eksistere, og air:bit vil starte med en helt ny fil neste<br/>gang du setter SD-kortet inn i air:bit igjen.</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SD.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SD_CS_PIN 10</span>

File file;
<span class="hljs-keyword">int</span> counter;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// Activate CS-Pin control</span>
  pinMode(SD_CS_PIN, OUTPUT);

  <span class="hljs-comment">// Startup SD-card reader</span>
  SD.begin(SD_CS_PIN);

  <span class="hljs-comment">// Define filename</span>
  <span class="hljs-keyword">char</span> filename[] = <span class="hljs-string">"testfile.txt"</span>;

  <span class="hljs-keyword">if</span> (SD.exists(filename)) {
    <span class="hljs-comment">// Open existing file for writing and append</span>
    file = SD.open(filename, O_WRITE | O_APPEND);
    file.println(<span class="hljs-string">"--------------------"</span>);
    file.println(<span class="hljs-string">"Filen ble åpnet på nytt."</span>);
  } <span class="hljs-keyword">else</span> {
    file = SD.open(filename, O_CREAT | O_WRITE);
    file.println(<span class="hljs-string">"Dette er den første linjen i filen."</span>);
  }
  file.flush(); <span class="hljs-comment">// Force saving data to SD-card</span>

  <span class="hljs-comment">// Start counter at 0</span>
  counter = <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  counter += <span class="hljs-number">1</span>;

  file.print(<span class="hljs-string">"Dette er linje nr.:"</span>);
  file.print(<span class="hljs-string">" "</span>);
  file.print(counter);
  file.println();

  file.flush();

  delay(<span class="hljs-number">1000</span>); <span class="hljs-comment">// Wait a second.</span>
}
</code></pre>
<p><strong>Merk:</strong> SD-kortet må være plugget i air:bit når du skrur på strømmen. Du kan<br/>ikke sette i SD-kortet mens air:bit er på å kjører. Koden som starter opp<br/>SD-kortleseren og åpner filen ligger i <code>setup</code>. Dvs., den kjøres bare én gang<br/>når air:bit starter opp.</p>
<h2 id="veien-videre">Veien videre</h2>
<p>Å bare skrive verdien til en teller-variabel er kanskje litt kjedelig og gir<br/>ikke så mye mening. Men du har kanskje lagt merke til at det ikke er noe særlig<br/>forskjell fra å skrive til en seriell-kobling eller å skrive til en fil på et<br/>SD-kort. Om du bare ser på koden i <code>loop</code>, og sammenlikner med<br/><a href="Variabler-og-telling-i-Arduino.html">teller-eksemplet som bruker seriell-kommunikasjon</a>, så ser<br/>du lite forskjell.</p>
<p>Det er mye du kan prøve å ekperimentere med nå. Du kan ta koden du skrev her,<br/>og kopiere alle <code>print</code>- og <code>println</code>-kommandoene og legge til at den også<br/>skriver samme tekst til den serielle tilkoblingen til PC-en i tillegg til at den<br/>skriver til SD-kortet. Du trenger da egentlig bare å bytte ut <code>file</code> med<br/><code>Serial</code> og du må huske å kjøre <code>Serial.begin</code> i <code>setup</code>.</p>
<p>Så kan du ta koden du skrev her i <code>setup</code> for å åpne filen, og bruke den for å<br/>endre de tidligere eksemplene til å skrive til filen på SD-kortet i stedet for<br/>eller i tillegg til å skrive til den serielle tilkoblingen med datamaskinen.</p>
<h2 id="g-videre">Gå videre</h2>
<p>&uarr; <a href="airbit-Programmering.html">Gå til <strong>innholdsfortegnelsen</strong></a><br/>&larr; <a href="Programmering-med-GPS-antenna.html">Gå tilbake forrige neste steg: <strong>GPS-antenna</strong></a><br/>&darr; <a href="airbit-Guides">Gå til hovedsider for <strong>Guider</strong></a></p>

                    </div>
                </div>
                <div class="col-xs-12 col-sm-3 col-sm-push-9 well">
                    <h1 id="meny">Meny</h1>
<ul>
<li><a href="Home.html">Hjem</a></li>
<li><a href="airbit-Guider.html">Guider</a><ul>
<li><a href="Guide-Bygging-og-Lodding.html">Bygging og Lodding</a></li>
<li><a href="Guide-Oppsett-for-programmering.html">Oppsett av programmvare</a></li>
<li><a href="Introduksjon-til-Arduino-programmering.html">Arduino programmering</a></li>
<li><a href="airbit-Programmering.html">air:bit programmering</a></li>
<li><a href="Feilsøking-av-programmeringsfeil.html">Feilsøking</a></li>
</ul>
</li>
<li><a href="airbit-Pinout.html">Pinout</a></li>
<li><a href="Dataformat.html">Dataformat</a></li>
<li><a href="Tekniske-Spesifikasjoner">Tekniske Spesifikasjoner</a></li>
</ul>

                </div>
            </div>

        </div>
    </div>
    <footer id="footer" class="footer"></footer>
</body>

</html>